login as: admuser
admuser@10.5.20.29's password:
Welcome to Ubuntu 22.04.5 LTS (GNU/Linux 5.15.0-157-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Tue Oct  7 09:33:12 AM CEST 2025

  System load:  0.03               Processes:              324
  Usage of /:   13.5% of 96.37GB   Users logged in:        1
  Memory usage: 31%                IPv4 address for ens33: 10.5.20.29
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

0 updates can be applied immediately.

1 additional security update can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm

New release '24.04.3 LTS' available.
Run 'do-release-upgrade' to upgrade to it.


Last login: Tue Oct  7 08:34:30 2025 from 10.5.34.33
admuser@admuser:~$ sudo -i
[sudo] password for admuser:
root@admuser:~#
root@admuser:~#
root@admuser:~#
root@admuser:~# # Go to the application directory
cd /opt/ceshtje-ligjore
# Pull the latest code from GitHub
git pull origin main
# Rebuild the application
npm run build
# Restart PM2
pm2 restart albpetrol-legal
# Check it's running
pm2 logs albpetrol-legal --lines 20
From https://github.com/thanasdinaku/legal.albpetrol
 * branch            main       -> FETCH_HEAD
Already up to date.

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.20 building for production...
✓ 2408 modules transformed.
../dist/public/index.html                                         1.09 kB │ gzip:   0.62 kB
../dist/public/assets/Albpetrol.svg_1754604323425-C1lBmiZp.png   93.96 kB
../dist/public/assets/index-D1b5zML-.css                        159.05 kB │ gzip:  25.36 kB
../dist/public/assets/index-x-Prd7SV.js                         860.03 kB │ gzip: 252.86 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 3.67s

  dist/index.js  189.1kb

⚡ Done in 7ms
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [albpetrol-legal](ids: [ 0 ])
[PM2] [albpetrol-legal](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ fork     │ 1    │ online    │ 0%       │ 20.4mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [albpetrol-legal] process (change the value with --lines option)
/root/.pm2/logs/albpetrol-legal-error-0.log last 20 lines:
0|albpetro | Error fetching backups: SyntaxError: Unexpected token 'd', "data_entri"... is not valid JSON
0|albpetro |     at JSON.parse (<anonymous>)
0|albpetro |     at BackupService.getBackups (file:///opt/ceshtje-ligjore/dist/index.js:3017:26)
0|albpetro |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|albpetro |     at async file:///opt/ceshtje-ligjore/dist/index.js:4244:23
0|albpetro | Error getting backups: SyntaxError: Unexpected token 'd', "data_entri"... is not valid JSON
0|albpetro |     at JSON.parse (<anonymous>)
0|albpetro |     at BackupService.getBackups (file:///opt/ceshtje-ligjore/dist/index.js:3017:26)
0|albpetro |     at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
0|albpetro |     at async file:///opt/ceshtje-ligjore/dist/index.js:4244:23

/root/.pm2/logs/albpetrol-legal-out-0.log last 20 lines:
0|albpetro | Checking hearings within ≤26 hours: up to 08.10.2025, 09:24 [Albania Time]
0|albpetro | Checking entry 1 - hearing field: "2025-10-05T23:12"
0|albpetro | Parsing date string: 2025-10-05T23:12
0|albpetro | Parsed exactly as stored: 2025-10-05T21:12:00.000Z from input: 2025-10-05T23:12
0|albpetro | Parsed hearing date: 2025-10-05T21:12:00.000Z
0|albpetro |     Window check: hearing=2025-10-05T21:12:00.000Z, now=2025-10-07T07:24:16.835Z, hours_ahead=-34.2, window=≤26h, result=false
0|albpetro | Is within notification window: false (hearing at 2025-10-05T21:12:00.000Z is -34 hours from now)
0|albpetro | Checking entry 1 appeal - hearing field: "2025-10-05T23:42"
0|albpetro | Parsing date string: 2025-10-05T23:42
0|albpetro | Parsed exactly as stored: 2025-10-05T21:42:00.000Z from input: 2025-10-05T23:42
0|albpetro | Parsed appeal hearing date: 2025-10-05T21:42:00.000Z
0|albpetro |     Window check: hearing=2025-10-05T21:42:00.000Z, now=2025-10-07T07:24:16.835Z, hours_ahead=-33.7, window=≤26h, result=false
0|albpetro | Appeal hearing is within notification window: false (hearing at 2025-10-05T21:42:00.000Z is -34 hours from now)
0|albpetro | Found 0 upcoming hearings
0|albpetro | 9:24:39 AM [express] GET /api/system/backups 500 in 13ms :: {"error":"Failed to get backups"}
0|albpetro | 9:24:39 AM [express] GET /api/system/status 200 in 13ms :: {"database":{"status":"Connected","lastCh…
0|albpetro | 9:26:23 AM [express] GET /api/admin/database-stats 304 in 15ms :: {"totalStorage":"100.0 MB","usedSt…
0|albpetro | 9:26:23 AM [express] GET /api/admin/email-settings 304 in 15ms :: {"enabled":true,"subject":"Hyrje e…
0|albpetro | 9:30:43 AM [express] GET /api/dashboard/stats 304 in 16ms :: {"totalEntries":2,"todayEntries":1,"act…
0|albpetro | 9:30:43 AM [express] GET /api/dashboard/recent-entries 304 in 18ms :: [{"id":3,"paditesi":"Aaaaa","i…

0|albpetrol-legal  | 🚀 CourtHearingScheduler constructor called
0|albpetrol-legal  | ══════════════════════════════════════════════════════════════
0|albpetrol-legal  | 🕐 SYSTEM TIMEZONE CONFIGURATION - GMT+1 (ALBANIA TIME)
0|albpetrol-legal  | ══════════════════════════════════════════════════════════════
0|albpetrol-legal  | 🌍 Configured Timezone: Europe/Tirane (GMT+1 - Albania Time)
0|albpetrol-legal  | ⏰ Current UTC Time: 2025-10-07T07:33:48.531Z
0|albpetrol-legal  | 🇦🇱 Current Albania Time (GMT+1): 07.10.2025, 09:33
0|albpetrol-legal  | 📅 Albanian Date Format: 07.10.2025
0|albpetrol-legal  | 🕒 Albanian Time Format: 09:33
0|albpetrol-legal  | ══════════════════════════════════════════════════════════════
0|albpetrol-legal  | 🟢 Starting court hearing notification scheduler...
0|albpetrol-legal  | ✅ Scheduler configured: checking every 10 minutes, startup check in 5 seconds
0|albpetrol-legal  | 🔧 Initializing database...
0|albpetrol-legal  | 🔑 Generated scrypt password hash for admin user
0|albpetrol-legal  | ✅ Admin user already exists
0|albpetrol-legal  | ✅ Admin password already in correct scrypt format
0|albpetrol-legal  | ✅ Database initialization completed
0|albpetrol-legal  | Initializing court hearing notification scheduler...
0|albpetrol-legal  | ⚠️ Scheduler already running, skipping duplicate start
0|albpetrol-legal  | Scheduler instance created, starting automatic notifications...
0|albpetrol-legal  | 9:33:48 AM [express] serving on port 5000
0|albpetrol-legal  | [2025-10-07T07:33:53.542Z] 🚀 STARTUP CHECK TRIGGERED (5 seconds after start)
0|albpetrol-legal  | [2025-10-07T07:33:53.543Z] === COURT HEARING CHECK STARTED ===
0|albpetrol-legal  | Current time (GMT+1): 07.10.2025, 09:33
0|albpetrol-legal  | Checking hearings within ≤26 hours: up to 08.10.2025, 09:33 [Albania Time]
0|albpetrol-legal  | Checking entry 1 - hearing field: "2025-10-05T23:12"
0|albpetrol-legal  | Parsing date string: 2025-10-05T23:12
0|albpetrol-legal  | Parsed exactly as stored: 2025-10-05T21:12:00.000Z from input: 2025-10-05T23:12
0|albpetrol-legal  | Parsed hearing date: 2025-10-05T21:12:00.000Z
0|albpetrol-legal  |     Window check: hearing=2025-10-05T21:12:00.000Z, now=2025-10-07T07:33:53.548Z, hours_ahead=-34.4, window=≤26h, result=false
0|albpetrol-legal  | Is within notification window: false (hearing at 2025-10-05T21:12:00.000Z is -34 hours from now)
0|albpetrol-legal  | Checking entry 1 appeal - hearing field: "2025-10-05T23:42"
0|albpetrol-legal  | Parsing date string: 2025-10-05T23:42
0|albpetrol-legal  | Parsed exactly as stored: 2025-10-05T21:42:00.000Z from input: 2025-10-05T23:42
0|albpetrol-legal  | Parsed appeal hearing date: 2025-10-05T21:42:00.000Z
0|albpetrol-legal  |     Window check: hearing=2025-10-05T21:42:00.000Z, now=2025-10-07T07:33:53.548Z, hours_ahead=-33.9, window=≤26h, result=false
0|albpetrol-legal  | Appeal hearing is within notification window: false (hearing at 2025-10-05T21:42:00.000Z is -34 hours from now)
0|albpetrol-legal  | Found 0 upcoming hearings
0|albpetrol-legal  | 9:34:18 AM [express] GET /api/auth/user 304 in 7ms :: {"id":"it-system-admin","email":"it.system@alb…
0|albpetrol-legal  | 9:34:18 AM [express] GET /api/dashboard/recent-entries 304 in 6ms :: [{"id":3,"paditesi":"Aaaaa","iP…
0|albpetrol-legal  | 9:34:18 AM [express] GET /api/dashboard/stats 304 in 11ms :: {"totalEntries":2,"todayEntries":1,"act…
0|albpetrol-legal  | 9:34:20 AM [express] GET /api/auth/user 304 in 3ms :: {"id":"it-system-admin","email":"it.system@alb…
0|albpetrol-legal  | 9:34:21 AM [express] GET /api/dashboard/stats 304 in 4ms :: {"totalEntries":2,"todayEntries":1,"acti…
0|albpetrol-legal  | 9:34:21 AM [express] GET /api/dashboard/recent-entries 304 in 11ms :: [{"id":3,"paditesi":"Aaaaa","i…
0|albpetrol-legal  | 9:34:22 AM [express] GET /api/auth/user 304 in 4ms :: {"id":"it-system-admin","email":"it.system@alb…
0|albpetrol-legal  | 9:34:22 AM [express] GET /api/dashboard/recent-entries 304 in 5ms :: [{"id":3,"paditesi":"Aaaaa","iP…
0|albpetrol-legal  | 9:34:22 AM [express] GET /api/dashboard/stats 304 in 6ms :: {"totalEntries":2,"todayEntries":1,"acti…
0|albpetrol-legal  | 9:34:23 AM [express] GET /api/auth/user 304 in 4ms :: {"id":"it-system-admin","email":"it.system@alb…
0|albpetrol-legal  | 9:34:23 AM [express] GET /api/dashboard/recent-entries 304 in 5ms :: [{"id":3,"paditesi":"Aaaaa","iP…
0|albpetrol-legal  | 9:34:23 AM [express] GET /api/dashboard/stats 304 in 5ms :: {"totalEntries":2,"todayEntries":1,"acti…
0|albpetrol-legal  | 9:34:26 AM [express] GET /api/auth/user 304 in 3ms :: {"id":"it-system-admin","email":"it.system@alb…
0|albpetrol-legal  | 9:34:26 AM [express] GET /api/dashboard/recent-entries 304 in 4ms :: [{"id":3,"paditesi":"Aaaaa","iP…
0|albpetrol-legal  | 9:34:26 AM [express] GET /api/dashboard/stats 304 in 6ms :: {"totalEntries":2,"todayEntries":1,"acti…
0|albpetrol-legal  | 9:34:27 AM [express] GET /api/auth/user 304 in 4ms :: {"id":"it-system-admin","email":"it.system@alb…
0|albpetrol-legal  | 9:34:27 AM [express] GET /api/dashboard/stats 304 in 5ms :: {"totalEntries":2,"todayEntries":1,"acti…
0|albpetrol-legal  | 9:34:27 AM [express] GET /api/dashboard/recent-entries 304 in 6ms :: [{"id":3,"paditesi":"Aaaaa","iP…
^C
root@admuser:/opt/ceshtje-ligjore# # List backup files to find the corrupt one
ls -la /opt/ceshtje-ligjore/backups/

# Remove any corrupt backup files if found
# Then restart PM2
pm2 restart albpetrol-legal
total 280
drwxr-xr-x  2 root root  4096 Oct  7 02:41 .
drwxr-xr-x 15 root root 12288 Oct  7 09:33 ..
-rw-r--r--  1 root root  4036 Oct  3 23:41 backup-data-only-2025-09-30T10-42-05-671Z.sql
-rw-r--r--  1 root root  4036 Oct  3 23:41 backup-data-only-2025-09-30T10-42-10-048Z.sql
-rw-r--r--  1 root root  2645 Oct  6 10:55 backup-data-only-2025-10-06T08-55-06-454Z.sql
-rw-r--r--  1 root root 17919 Oct  3 23:41 backup-full-2025-08-21T14-56-43-062Z.sql
-rw-r--r--  1 root root 18157 Oct  3 23:41 backup-full-2025-08-21T14-56-47-609Z.sql
-rw-r--r--  1 root root 18413 Oct  5 23:33 backup-full-2025-10-05T21-33-13-472Z.sql
-rw-r--r--  1 root root 18504 Oct  5 23:33 backup-full-2025-10-05T21-33-15-654Z.sql
-rw-r--r--  1 root root 18592 Oct  5 23:33 backup-full-2025-10-05T21-33-33-681Z.sql
-rw-r--r--  1 root root 18683 Oct  5 23:33 backup-full-2025-10-05T21-33-35-892Z.sql
-rw-r--r--  1 root root 18770 Oct  5 23:37 backup-full-2025-10-05T21-37-17-200Z.sql
-rw-r--r--  1 root root 25582 Oct  7 02:24 case-edit-form.tsx.backup.20251007_022416
-rw-r--r--  1 root root 26085 Oct  7 02:24 case-entry-form.tsx.backup.20251007_022416
-rw-r--r--  1 root root 26108 Oct  7 02:41 edit.backup.1759797680
-rw-r--r--  1 root root 26640 Oct  7 02:41 entry.backup.1759797680
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [albpetrol-legal](ids: [ 0 ])
[PM2] [albpetrol-legal](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ fork     │ 2    │ online    │ 0%       │ 17.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@admuser:/opt/ceshtje-ligjore#
