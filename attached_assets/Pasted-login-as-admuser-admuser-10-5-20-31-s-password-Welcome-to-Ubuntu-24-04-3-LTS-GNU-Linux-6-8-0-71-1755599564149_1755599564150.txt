login as: admuser
admuser@10.5.20.31's password:
Welcome to Ubuntu 24.04.3 LTS (GNU/Linux 6.8.0-71-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/pro

 System information as of Tue Aug 19 10:26:28 AM UTC 2025

  System load:  0.09               Processes:              306
  Usage of /:   19.3% of 71.77GB   Users logged in:        1
  Memory usage: 49%                IPv4 address for ens33: 10.5.20.31
  Swap usage:   0%

 * Strictly confined Kubernetes makes edge and IoT secure. Learn how MicroK8s
   just raised the bar for easy, resilient and secure K8s cluster deployment.

   https://ubuntu.com/engage/secure-kubernetes-at-the-edge

Expanded Security Maintenance for Applications is not enabled.

10 updates can be applied immediately.
To see these additional updates run: apt list --upgradable

5 additional security updates can be applied with ESM Apps.
Learn more about enabling ESM Apps service at https://ubuntu.com/esm


Last login: Tue Aug 19 09:42:37 2025 from 10.5.34.33
admuser@ceshtjeligjore:~$ sudo -i
[sudo] password for admuser:
root@ceshtjeligjore:~# cd /opt/ceshtje_ligjore/ceshtje_ligjore
wget https://workspace.truealbos.repl.co/SERVER_DEPLOYMENT_COMMANDS.sh -O deploy                                                                                                                                                             .sh
--2025-08-19 10:26:51--  https://workspace.truealbos.repl.co/SERVER_DEPLOYMENT_C                                                                                                                                                             OMMANDS.sh
Resolving workspace.truealbos.repl.co (workspace.truealbos.repl.co)... failed: N                                                                                                                                                             ame or service not known.
wget: unable to resolve host address ‘workspace.truealbos.repl.co’
root@ceshtjeligjore:/opt/ceshtje_ligjore/ceshtje_ligjore# cd /opt/ceshtje_ligjore/ceshtje_ligjore && \
sudo cp -r . ../backup_$(date +%Y%m%d_%H%M%S) && \
sudo systemctl stop albpetrol-legal && \
echo "Service stopped, ready for file updates..." && \
echo "Update the following files now:" && \
echo "1. client/src/components/case-edit-form.tsx" && \
echo "2. client/src/components/DocumentUploader.tsx" && \
echo "Press Enter when files are updated..." && \
read && \
sudo chown -R admuser:admuser . && \
sudo chmod -R 755 client/src/components/ && \
sudo chmod -R 755 server/ && \
npm install --production && \
npm run build && \
sudo systemctl start albpetrol-legal && \
sleep 15 && \
sudo systemctl is-active albpetrol-legal && \
echo "Deployment completed - check https://legal.albpetrol.al"
Service stopped, ready for file updates...
Update the following files now:
1. client/src/components/case-edit-form.tsx
2. client/src/components/DocumentUploader.tsx
Press Enter when files are updated...

npm warn config production Use `--omit=dev` instead.

up to date, audited 584 packages in 1s

78 packages are looking for funding
  run `npm fund` for details

2 vulnerabilities (1 low, 1 high)

To address issues that do not require attention, run:
  npm audit fix

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.5.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.5.2
npm notice To update run: npm install -g npm@11.5.2
npm notice

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

sh: 1: vite: not found
root@ceshtjeligjore:/opt/ceshtje_ligjore/ceshtje_ligjore# # Install all dependencies (including dev dependencies for building)
npm install

# Build the application
npm run build

# Start the service
sudo systemctl start albpetrol-legal

# Wait and check status
sleep 15
sudo systemctl is-active albpetrol-legal
sudo systemctl status albpetrol-legal --no-pager

echo "Deployment completed - check https://legal.albpetrol.al"
npm warn deprecated @esbuild-kit/esm-loader@2.6.5: Merged into tsx: https://tsx.is
npm warn deprecated @esbuild-kit/core-utils@3.3.2: Merged into tsx: https://tsx.is

added 98 packages, and audited 682 packages in 2s

90 packages are looking for funding
  run `npm fund` for details

9 vulnerabilities (1 low, 7 moderate, 1 high)

To address issues that do not require attention, run:
  npm audit fix

To address all issues possible (including breaking changes), run:
  npm audit fix --force

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.19 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 66 modules transformed.
x Build failed in 1.10s
error during build:
[vite:esbuild] Transform failed with 1 error:
/opt/ceshtje_ligjore/ceshtje_ligjore/client/src/components/case-entry-form.tsx:1:10: ERROR: Expected "]" but found "component"
file: /opt/ceshtje_ligjore/ceshtje_ligjore/client/src/components/case-entry-form.tsx:1:10

Expected "]" but found "component"
1  |  [Complete component code as shown above]
   |            ^
2  |

    at failureErrorWithLog (/opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/vite/node_modules/esbuild/lib/main.js:1472:15)
    at /opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/vite/node_modules/esbuild/lib/main.js:755:50
    at responseCallbacks.<computed> (/opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/vite/node_modules/esbuild/lib/main.js:622:9)
    at handleIncomingPacket (/opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/vite/node_modules/esbuild/lib/main.js:677:12)
    at Socket.readFromStdout (/opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/vite/node_modules/esbuild/lib/main.js:600:7)
    at Socket.emit (node:events:524:28)
    at addChunk (node:internal/streams/readable:561:12)
    at readableAddChunkPushByteMode (node:internal/streams/readable:512:3)
    at Readable.push (node:internal/streams/readable:392:5)
    at Pipe.onStreamRead (node:internal/stream_base_commons:191:23)


active
● albpetrol-legal.service - Albpetrol Legal Management System
     Loaded: loaded (/etc/systemd/system/albpetrol-legal.service; enabled; preset: enabled)
     Active: active (running) since Tue 2025-08-19 10:30:01 UTC; 15s ago
   Main PID: 521069 (node)
      Tasks: 11 (limit: 9428)
     Memory: 53.4M (peak: 76.2M)
        CPU: 690ms
     CGroup: /system.slice/albpetrol-legal.service
             └─521069 /usr/bin/node dist/index.js

Aug 19 10:30:01 ceshtjeligjore systemd[1]: Started albpetrol-legal.service - Albpetrol Legal Management System.
Aug 19 10:30:02 ceshtjeligjore albpetrol-legal[521069]: 10:30:02 AM [express] serving on port 5000
Deployment completed - check https://legal.albpetrol.al
root@ceshtjeligjore:/opt/ceshtje_ligjore/ceshtje_ligjore# # Check what's wrong with the file
head -5 client/src/components/case-entry-form.tsx

# Remove the corrupted first line and fix it
sed -i '1s/.*/import { useState } from "react";/' client/src/components/case-entry-form.tsx

# Build again
npm run build

# Restart service with new build
sudo systemctl restart albpetrol-legal

# Verify it's working
sudo systemctl status albpetrol-legal --no-pager
echo "Fixed - check https://legal.albpetrol.al"
[Complete component code as shown above]

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.19 building for production...
transforming (3) src/main.tsxBrowserslist: browsers data (caniuse-lite) is 10 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
✓ 2153 modules transformed.
x Build failed in 2.71s
error during build:
client/src/pages/data-entry.tsx (6:7): "default" is not exported by "client/src/components/case-entry-form.tsx", imported by "client/src/pages/data-entry.tsx".
file: /opt/ceshtje_ligjore/ceshtje_ligjore/client/src/pages/data-entry.tsx:6:7

4: import Sidebar from "@/components/sidebar";
5: import Header from "@/components/header";
6: import CaseEntryForm from "@/components/case-entry-form";
          ^
7:
8: export default function DataEntry() {

    at getRollupError (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/parseAst.js:396:41)
    at error (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/parseAst.js:392:42)
    at Module.error (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:15588:16)
    at Module.traceVariable (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:16037:29)
    at ModuleScope.findVariable (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:13820:39)
    at FunctionScope.findVariable (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:5283:38)
    at FunctionBodyScope.findVariable (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:5283:38)
    at Identifier.bind (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:5066:40)
    at CallExpression.bind (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:2649:28)
    at CallExpression.bind (file:///opt/ceshtje_ligjore/ceshtje_ligjore/node_modules/rollup/dist/es/shared/node-entry.js:11284:15)
● albpetrol-legal.service - Albpetrol Legal Management System
     Loaded: loaded (/etc/systemd/system/albpetrol-legal.service; enabled; preset: enabled)
     Active: active (running) since Tue 2025-08-19 10:31:44 UTC; 12ms ago
   Main PID: 521202 (node)
      Tasks: 6 (limit: 9428)
     Memory: 3.7M (peak: 3.7M)
        CPU: 8ms
     CGroup: /system.slice/albpetrol-legal.service
             └─521202 /usr/bin/node dist/index.js

Aug 19 10:31:44 ceshtjeligjore systemd[1]: Started albpetrol-legal.service - Albpetrol Legal Management System.
Fixed - check https://legal.albpetrol.al
root@ceshtjeligjore:/opt/ceshtje_ligjore/ceshtje_ligjore#
