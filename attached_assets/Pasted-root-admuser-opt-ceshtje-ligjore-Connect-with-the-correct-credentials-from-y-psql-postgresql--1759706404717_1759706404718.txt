root@admuser:/opt/ceshtje-ligjore# # Connect with the correct credentials from y
psql "postgresql://albpetrol_user:SecurePass2025@localhost:5432/albpetrol_legal_
psql (14.19 (Ubuntu 14.19-0ubuntu0.22.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, co
Type "help" for help.

albpetrol_legal_db=> -- Check users
SELECT id, email, "firstName", "lastName" FROM users;

-- Check what createdById values exist
SELECT DISTINCT "createdById" FROM data_entries;

-- Check the column structure
\d data_entries
ERROR:  column "firstName" does not exist
LINE 1: SELECT id, email, "firstName", "lastName" FROM users;
                          ^
HINT:  Perhaps you meant to reference the column "users.first_name".
ERROR:  column "createdById" does not exist
LINE 1: SELECT DISTINCT "createdById" FROM data_entries;
                        ^
                                                 Table "public.data_entries"
           Column            |            Type             | Collation | Nullabl
-----------------------------+-----------------------------+-----------+--------
 id                          | integer                     |           | not nul
 paditesi                    | character varying(255)      |           | not nul
 i_paditur                   | character varying(255)      |           | not nul
 person_i_trete              | character varying(255)      |           |
 objekti_i_padise            | text                        |           |
 gjykata_shkalle             | character varying(500)      |           |
 faza_gjykata_shkalle        | character varying(255)      |           |
 zhvillimi_seances_shkalle_i | character varying           |           |
 gjykata_apelit              | character varying(500)      |           |
 faza_gjykata_apelit         | character varying(255)      |           |
 zhvillimi_seances_apel      | character varying           |           |
 faza_aktuale                | character varying(255)      |           |
 perfaqesuesi                | character varying(255)      |           |
 demi_i_pretenduar           | character varying(255)      |           |
 shuma_gjykata               | character varying(255)      |           |
 vendim_ekzekutim            | character varying(255)      |           |
 faza_ekzekutim              | character varying(255)      |           |
 ankimuar                    | character varying(255)      |           |
 perfunduar                  | character varying(255)      |           |
 gjykata_larte               | character varying(255)      |           |
 attachments                 | jsonb                       |           |
 created_by_id               | character varying           |           | not nul
 created_at                  | timestamp without time zone |           |
 updated_at                  | timestamp without time zone |           |
Indexes:
    "data_entries_pkey" PRIMARY KEY, btree (id)
Foreign-key constraints:
    "data_entries_created_by_id_users_id_fk" FOREIGN KEY (created_by_id) REFEREN

albpetrol_legal_db=> q
albpetrol_legal_db-> q
albpetrol_legal_db-> \q
root@admuser:/opt/ceshtje-ligjore# nano server/storage.ts
root@admuser:/opt/ceshtje-ligjore# npm run build
pm2 restart albpetrol-legal

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.20 building for production...
✓ 2411 modules transformed.
../dist/public/index.html                                         1.09 kB │ gzip:   0.62 kB
../dist/public/assets/Albpetrol.svg_1754604323425-C1lBmiZp.png   93.96 kB
../dist/public/assets/index-D1b5zML-.css                        159.05 kB │ gzip:  25.36 kB
../dist/public/assets/index-BaTynYKG.js                         870.49 kB │ gzip: 255.57 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 3.86s
✘ [ERROR] Expected ";" but found "db"

    server/storage.ts:693:10:
      693 │     await db.transaction(async (tx) => {
          │           ~~
          ╵           ;

1 error
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [albpetrol-legal](ids: [ 0 ])
[PM2] [albpetrol-legal](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ fork     │ 9    │ online    │ 0%       │ 18.9mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
root@admuser:/opt/ceshtje-ligjore# nano server/storage.ts
root@admuser:/opt/ceshtje-ligjore# nano server/storage.ts
root@admuser:/opt/ceshtje-ligjore# npm run build
pm2 restart albpetrol-legal
pm2 logs albpetrol-legal --lines 20

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.20 building for production...
✓ 2411 modules transformed.
../dist/public/index.html                                         1.09 kB │ gzip:   0.62 kB
../dist/public/assets/Albpetrol.svg_1754604323425-C1lBmiZp.png   93.96 kB
../dist/public/assets/index-D1b5zML-.css                        159.05 kB │ gzip:  25.36 kB
../dist/public/assets/index-BaTynYKG.js                         870.49 kB │ gzip: 255.57 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
✓ built in 3.79s
✘ [ERROR] Expected ";" but found "db"

    server/storage.ts:690:10:
      690 │     await db.transaction(async (tx) => {
          │           ~~
          ╵           ;

1 error
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [albpetrol-legal](ids: [ 0 ])
[PM2] [albpetrol-legal](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ fork     │ 10   │ online    │ 0%       │ 17.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
[TAILING] Tailing last 20 lines for [albpetrol-legal] process (change the value with --lines option)
/opt/ceshtje-ligjore/logs/err-0.log last 20 lines:
0|albpetro | 2025-10-06T00:31:49:   'sessions',
0|albpetro | 2025-10-06T00:31:49:   'database_checkpoints',
0|albpetro | 2025-10-06T00:31:49:   'system_backups'
0|albpetro | 2025-10-06T00:31:49: ]
0|albpetro | 2025-10-06T00:31:49: Warning: Corrupted tables field for backup 3a8fd2db-3e60-4bc9-ac7e-3aa9484d309c: [
0|albpetro | 2025-10-06T00:31:49:   'data_entries',
0|albpetro | 2025-10-06T00:31:49:   'users',
0|albpetro | 2025-10-06T00:31:49:   'system_settings',
0|albpetro | 2025-10-06T00:31:49:   'sessions',
0|albpetro | 2025-10-06T00:31:49:   'database_checkpoints',
0|albpetro | 2025-10-06T00:31:49:   'system_backups'
0|albpetro | 2025-10-06T00:31:49: ]
0|albpetro | 2025-10-06T00:31:49: Warning: Corrupted tables field for backup 2e264b7d-8675-4256-8c91-bbf79ee70432: [
0|albpetro | 2025-10-06T00:31:49:   'data_entries',
0|albpetro | 2025-10-06T00:31:49:   'users',
0|albpetro | 2025-10-06T00:31:49:   'system_settings',
0|albpetro | 2025-10-06T00:31:49:   'sessions',
0|albpetro | 2025-10-06T00:31:49:   'database_checkpoints',
0|albpetro | 2025-10-06T00:31:49:   'system_backups'
0|albpetro | 2025-10-06T00:31:49: ]

/opt/ceshtje-ligjore/logs/out-0.log last 20 lines:
0|albpetro | 2025-10-06T01:05:19:     Window check: hearing=2025-10-05T21:42:00.000Z, now=2025-10-05T23:05:19.062Z, hours_ahead=-1.4, window=≤26h, result=false
0|albpetro | 2025-10-06T01:05:19: Appeal hearing is within notification window: false (hearing at 2025-10-05T21:42:00.000Z is -1 hours from now)
0|albpetro | 2025-10-06T01:05:19: Found 0 upcoming hearings
0|albpetro | 2025-10-06T01:15:14: [2025-10-05T23:15:14.057Z] 🕐 AUTOMATIC CHECK TRIGGERED (every 10 minutes)
0|albpetro | 2025-10-06T01:15:14: [2025-10-05T23:15:14.057Z] === COURT HEARING CHECK STARTED ===
0|albpetro | 2025-10-06T01:15:14: Current time (GMT+1): 06.10.2025, 01:15
0|albpetro | 2025-10-06T01:15:14: Checking hearings within ≤26 hours: up to 07.10.2025, 01:15 [Albania Time]
0|albpetro | 2025-10-06T01:15:14: Checking entry 1 - hearing field: "2025-10-05T23:12"
0|albpetro | 2025-10-06T01:15:14: Parsing date string: 2025-10-05T23:12
0|albpetro | 2025-10-06T01:15:14: Parsed exactly as stored: 2025-10-05T21:12:00.000Z from input: 2025-10-05T23:12
0|albpetro | 2025-10-06T01:15:14: Parsed hearing date: 2025-10-05T21:12:00.000Z
0|albpetro | 2025-10-06T01:15:14:     Window check: hearing=2025-10-05T21:12:00.000Z, now=2025-10-05T23:15:14.069Z, hours_ahead=-2.1, window=≤26h, result=false
0|albpetro | 2025-10-06T01:15:14: Is within notification window: false (hearing at 2025-10-05T21:12:00.000Z is -2 hours from now)
0|albpetro | 2025-10-06T01:15:14: Checking entry 1 appeal - hearing field: "2025-10-05T23:42"
0|albpetro | 2025-10-06T01:15:14: Parsing date string: 2025-10-05T23:42
0|albpetro | 2025-10-06T01:15:14: Parsed exactly as stored: 2025-10-05T21:42:00.000Z from input: 2025-10-05T23:42
0|albpetro | 2025-10-06T01:15:14: Parsed appeal hearing date: 2025-10-05T21:42:00.000Z
0|albpetro | 2025-10-06T01:15:14:     Window check: hearing=2025-10-05T21:42:00.000Z, now=2025-10-05T23:15:14.070Z, hours_ahead=-1.6, window=≤26h, result=false
0|albpetro | 2025-10-06T01:15:14: Appeal hearing is within notification window: false (hearing at 2025-10-05T21:42:00.000Z is -2 hours from now)
0|albpetro | 2025-10-06T01:15:14: Found 0 upcoming hearings

0|albpetrol-legal  | 2025-10-06T01:18:13: 🚀 CourtHearingScheduler constructor called
0|albpetrol-legal  | 2025-10-06T01:18:13:
0|albpetrol-legal  | 2025-10-06T01:18:13: ══════════════════════════════════════════════════════════════
0|albpetrol-legal  | 2025-10-06T01:18:13: 🕐 SYSTEM TIMEZONE CONFIGURATION - GMT+1 (ALBANIA TIME)
0|albpetrol-legal  | 2025-10-06T01:18:13: ══════════════════════════════════════════════════════════════
0|albpetrol-legal  | 2025-10-06T01:18:13: 🌍 Configured Timezone: Europe/Tirane (GMT+1 - Albania Time)
0|albpetrol-legal  | 2025-10-06T01:18:13: ⏰ Current UTC Time: 2025-10-05T23:18:13.252Z
0|albpetrol-legal  | 2025-10-06T01:18:13: 🇦🇱 Current Albania Time (GMT+1): 06.10.2025, 01:18
0|albpetrol-legal  | 2025-10-06T01:18:13: 📅 Albanian Date Format: 06.10.2025
0|albpetrol-legal  | 2025-10-06T01:18:13: 🕒 Albanian Time Format: 01:18
0|albpetrol-legal  | 2025-10-06T01:18:13: ══════════════════════════════════════════════════════════════
0|albpetrol-legal  | 2025-10-06T01:18:13:
0|albpetrol-legal  | 2025-10-06T01:18:13: 🟢 Starting court hearing notification scheduler...
0|albpetrol-legal  | 2025-10-06T01:18:13: ✅ Scheduler configured: checking every 10 minutes, startup check in 5 seconds
0|albpetrol-legal  | 2025-10-06T01:18:13: 🔧 Initializing database...
0|albpetrol-legal  | 2025-10-06T01:18:13: 🔑 Generated scrypt password hash for admin user
0|albpetrol-legal  | 2025-10-06T01:18:13: ✅ Admin user already exists
0|albpetrol-legal  | 2025-10-06T01:18:13: ✅ Admin password already in correct scrypt format
0|albpetrol-legal  | 2025-10-06T01:18:13: ✅ Database initialization completed
0|albpetrol-legal  | 2025-10-06T01:18:13: Initializing court hearing notification scheduler...
0|albpetrol-legal  | 2025-10-06T01:18:13: ⚠️ Scheduler already running, skipping duplicate start
0|albpetrol-legal  | 2025-10-06T01:18:13: Scheduler instance created, starting automatic notifications...
0|albpetrol-legal  | 2025-10-06T01:18:13: 1:18:13 AM [express] serving on port 5000
0|albpetrol-legal  | 2025-10-06T01:18:18: [2025-10-05T23:18:18.264Z] 🚀 STARTUP CHECK TRIGGERED (5 seconds after start)
0|albpetrol-legal  | 2025-10-06T01:18:18: [2025-10-05T23:18:18.265Z] === COURT HEARING CHECK STARTED ===
0|albpetrol-legal  | 2025-10-06T01:18:18: Current time (GMT+1): 06.10.2025, 01:18
0|albpetrol-legal  | 2025-10-06T01:18:18: Checking hearings within ≤26 hours: up to 07.10.2025, 01:18 [Albania Time]
0|albpetrol-legal  | 2025-10-06T01:18:18: Checking entry 1 - hearing field: "2025-10-05T23:12"
0|albpetrol-legal  | 2025-10-06T01:18:18: Parsing date string: 2025-10-05T23:12
0|albpetrol-legal  | 2025-10-06T01:18:18: Parsed exactly as stored: 2025-10-05T21:12:00.000Z from input: 2025-10-05T23:12
0|albpetrol-legal  | 2025-10-06T01:18:18: Parsed hearing date: 2025-10-05T21:12:00.000Z
0|albpetrol-legal  | 2025-10-06T01:18:18:     Window check: hearing=2025-10-05T21:12:00.000Z, now=2025-10-05T23:18:18.270Z, hours_ahead=-2.1, window=≤26h, result=false
0|albpetrol-legal  | 2025-10-06T01:18:18: Is within notification window: false (hearing at 2025-10-05T21:12:00.000Z is -2 hours from now)
0|albpetrol-legal  | 2025-10-06T01:18:18: Checking entry 1 appeal - hearing field: "2025-10-05T23:42"
0|albpetrol-legal  | 2025-10-06T01:18:18: Parsing date string: 2025-10-05T23:42
0|albpetrol-legal  | 2025-10-06T01:18:18: Parsed exactly as stored: 2025-10-05T21:42:00.000Z from input: 2025-10-05T23:42
0|albpetrol-legal  | 2025-10-06T01:18:18: Parsed appeal hearing date: 2025-10-05T21:42:00.000Z
0|albpetrol-legal  | 2025-10-06T01:18:18:     Window check: hearing=2025-10-05T21:42:00.000Z, now=2025-10-05T23:18:18.270Z, hours_ahead=-1.6, window=≤26h, result=false
0|albpetrol-legal  | 2025-10-06T01:18:18: Appeal hearing is within notification window: false (hearing at 2025-10-05T21:42:00.000Z is -2 hours from now)
0|albpetrol-legal  | 2025-10-06T01:18:18: Found 0 upcoming hearings
