root@admuser:/opt/ceshtje-ligjore# cd /opt/ceshtje-ligjore

# Backup current db.ts
cp server/db.ts server/db.ts.neon.backup

# Create the corrected db.ts for local PostgreSQL
cat > server/db.ts << 'EOF'
import { Pool } from 'pg';
import { drizzle } from 'drizzle-orm/node-postgres';
import * as schema from "@shared/schema";

if (!process.env.DATABASE_URL) {
  throw new Error(
    "DATABASE_URL must be set. Did you forget to provision a database?",
  );
}

export const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  max: 20,
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});

node dist/index.js \m@albpetrol.al" \user:SecurePass2025@localhost:5432/albpetro

> rest-express@1.0.0 build
> vite build && esbuild server/index.ts --platform=node --packages=external --bundle --format=esm --outdir=dist

vite v5.4.20 building for production...
âœ“ 2408 modules transformed.
../dist/public/index.html                                         1.09 kB â”‚ gzip:   0.62 kB
../dist/public/assets/Albpetrol.svg_1754604323425-C1lBmiZp.png   93.96 kB
../dist/public/assets/index-D1b5zML-.css                        159.05 kB â”‚ gzip:  25.36 kB
../dist/public/assets/index-x-Prd7SV.js                         860.03 kB â”‚ gzip: 252.86 kB

(!) Some chunks are larger than 500 kB after minification. Consider:
- Using dynamic import() to code-split the application
- Use build.rollupOptions.output.manualChunks to improve chunking: https://rollupjs.org/configuration-options/#output-manualchunks
- Adjust chunk size limit for this warning via build.chunkSizeWarningLimit.
âœ“ built in 3.66s

  dist/index.js  189.1kb

âš¡ Done in 6ms
ğŸš€ CourtHearingScheduler constructor called

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ• SYSTEM TIMEZONE CONFIGURATION - GMT+1 (ALBANIA TIME)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸŒ Configured Timezone: Europe/Tirane (GMT+1 - Albania Time)
â° Current UTC Time: 2025-10-07T07:01:39.236Z
ğŸ‡¦ğŸ‡± Current Albania Time (GMT+1): 07.10.2025, 09:01
ğŸ“… Albanian Date Format: 07.10.2025
ğŸ•’ Albanian Time Format: 09:01
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸŸ¢ Starting court hearing notification scheduler...
âœ… Scheduler configured: checking every 10 minutes, startup check in 5 seconds
ğŸ”§ Initializing database...
ğŸ”‘ Generated scrypt password hash for admin user
âœ… Admin user already exists
âœ… Admin password already in correct scrypt format
âœ… Database initialization completed
Initializing court hearing notification scheduler...
âš ï¸ Scheduler already running, skipping duplicate start
Scheduler instance created, starting automatic notifications...
9:01:39 AM [express] serving on port 5000
[2025-10-07T07:01:44.251Z] ğŸš€ STARTUP CHECK TRIGGERED (5 seconds after start)
[2025-10-07T07:01:44.252Z] === COURT HEARING CHECK STARTED ===
Current time (GMT+1): 07.10.2025, 09:01
Checking hearings within â‰¤26 hours: up to 08.10.2025, 09:01 [Albania Time]
Checking entry 1 - hearing field: "2025-10-05T23:12"
Parsing date string: 2025-10-05T23:12
Parsed exactly as stored: 2025-10-05T21:12:00.000Z from input: 2025-10-05T23:12
Parsed hearing date: 2025-10-05T21:12:00.000Z
    Window check: hearing=2025-10-05T21:12:00.000Z, now=2025-10-07T07:01:44.257Z, hours_ahead=-33.8, window=â‰¤26h, result=false
Is within notification window: false (hearing at 2025-10-05T21:12:00.000Z is -34 hours from now)
Checking entry 1 appeal - hearing field: "2025-10-05T23:42"
Parsing date string: 2025-10-05T23:42
Parsed exactly as stored: 2025-10-05T21:42:00.000Z from input: 2025-10-05T23:42
Parsed appeal hearing date: 2025-10-05T21:42:00.000Z
    Window check: hearing=2025-10-05T21:42:00.000Z, now=2025-10-07T07:01:44.257Z, hours_ahead=-33.3, window=â‰¤26h, result=false
Appeal hearing is within notification window: false (hearing at 2025-10-05T21:42:00.000Z is -33 hours from now)
Found 0 upcoming hearings
^C
root@admuser:/opt/ceshtje-ligjore#
