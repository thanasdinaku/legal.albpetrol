root@ceshtjeligjore:/opt/ceshtje-ligjore# # Check PM2 logs to see what's happening
pm2 logs albpetrol-legal --lines 10

# Check if port 5000 is actually listening
netstat -tlnp | grep :5000

# If the server isn't binding correctly, let's restart it with explicit binding
pm2 restart albpetrol-legal

# Wait a moment for it to start
sleep 3

# Test again
curl http://localhost:5000/api/health

# If still failing, let's check the server logs
pm2 logs albpetrol-legal --lines 20
[TAILING] Tailing last 10 lines for [albpetrol-legal] process (change the value with --lines option)
/root/.pm2/logs/albpetrol-legal-error-0.log last 10 lines:
/root/.pm2/logs/albpetrol-legal-out-0.log last 10 lines:
0|albpetro | Albpetrol Legal System server running on port 5000

^C
tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN      8951/node /opt/cesh 
Use --update-env to update environment variables
[PM2] Applying action restartProcessId on app [albpetrol-legal](ids: [ 0 ])
[PM2] [albpetrol-legal](0) ✓
┌────┬────────────────────┬──────────┬──────┬───────────┬──────────┬──────────┐
│ id │ name               │ mode     │ ↺    │ status    │ cpu      │ memory   │
├────┼────────────────────┼──────────┼──────┼───────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ fork     │ 1    │ online    │ 0%       │ 18.0mb   │
└────┴────────────────────┴──────────┴──────┴───────────┴──────────┴──────────┘
{"status":"ok","timestamp":"2025-08-20T10:44:41.568Z","app":"Albpetrol Legal System"}[TAILING] Tailing last 20 lines for [albpetrol-legal] process (change the value with --lines option)
/root/.pm2/logs/albpetrol-legal-error-0.log last 20 lines:
/root/.pm2/logs/albpetrol-legal-out-0.log last 20 lines:
0|albpetro | Albpetrol Legal System server running on port 5000
0|albpetro | Albpetrol Legal System server running on port 5000

^C
root@ceshtjeligjore:/opt/ceshtje-ligjore# # 1. Check if port 5000 is listening on all interfaces
netstat -tlnp | grep :5000

# 2. If not showing, let's test with a different approach
ss -tlnp | grep :5000

# 3. Test if the server responds to a different localhost address
curl http://127.0.0.1:5000/api/health

# 4. Check if the server is binding to IPv6 instead of IPv4
curl http://[::1]:5000/api/health

# 5. If none work, let's restart nginx and test the full stack
systemctl restart nginx
curl -I http://localhost/

# 6. Check nginx error logs if still failing
tail -f /var/log/nginx/error.log
tcp        0      0 0.0.0.0:5000            0.0.0.0:*               LISTEN      9051/node /opt/cesh 
LISTEN 0      511          0.0.0.0:5000       0.0.0.0:*    users:(("node /opt/cesht",pid=9051,fd=19))                                     
{"status":"ok","timestamp":"2025-08-20T10:45:34.629Z","app":"Albpetrol Legal System"}curl: (7) Failed to connect to ::1 port 5000 after 0 ms: Couldn't connect to server
HTTP/1.1 200 OK
Server: nginx/1.24.0 (Ubuntu)
Date: Wed, 20 Aug 2025 10:45:34 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 13265
Connection: keep-alive
X-Powered-By: Express
Accept-Ranges: bytes
Cache-Control: public, max-age=0
Last-Modified: Wed, 20 Aug 2025 10:33:03 GMT
ETag: W/"33d1-198c70a15f1"

2025/08/20 10:34:44 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:34:46 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:34:47 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:34:47 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:34:47 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:34:47 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:34:48 [error] 1562#1562: *222 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:39:39 [error] 1561#1561: *230 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:39:40 [error] 1561#1561: *230 connect() failed (111: Connection refused) while connecting to upstream, client: 10.5.20.31, server: 10.5.20.31, request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "10.5.20.31"
2025/08/20 10:41:09 [error] 8845#8845: *1 connect() failed (111: Connection refused) while connecting to upstream, client: 127.0.0.1, server: 10.5.20.31, request: "HEAD / HTTP/1.1", upstream: "http://127.0.0.1:5000/", host: "localhost"
