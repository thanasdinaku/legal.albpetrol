root@ceshtjeligjore:/opt/ceshtje-ligjore# cd /opt/ceshtje-ligjore

# Stop PM2
pm2 delete all

# Add the missing email notification schema to the schema file
cat >> shared/schema.ts << 'EOF'

// Email notification schemas
export const emailNotificationSchema = z.object({
  enabled: z.boolean().default(true),
  emailAddresses: z.array(z.string().email()).min(1, "Të paktën një adresë email është e kërkuar"),
  subject: z.string().min(1, "Tema është e kërkuar").default("Hyrje e re në sistemin e menaxhimit të çështjeve ligjore"),
  includeDetails: z.boolean().default(true),
});

export const changePasswordSchema = z.object({
  currentPassword: z.string().min(1, "Fjalëkalimi aktual është i kërkuar"),
  newPassword: z.string().min(8, "Fjalëkalimi duhet të jetë të paktën 8 karaktere"),
  confirmPassword: z.string().min(1, "Konfirmimi i fjalëkalimit është i kërkuar"),
}).refine((data) => data.newPassword === data.confirmPassword, {
  message: "Fjalëkalimet nuk përputhen",
  path: ["confirmPassword"],
});

export const insertCheckpointSchema = createInsertSchema(databaseCheckpoints).omit({
  id: true,
  createdAt: true,
});

export const insertSystemSettingsSchema = createInsertSchema(systemSettings).omit({
  id: true,
  updatedAt: true,
});

echo "📋 Features: Complete Albanian legal case management system"0.31:5000"ma>;
[PM2] Applying action deleteProcessId on app [all](ids: [ 0 ])
[PM2] [albpetrol-legal](0) ✓
┌────┬───────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name      │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
└────┴───────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[PM2] Starting /opt/ceshtje-ligjore/start_server.cjs in fork_mode (1 instance)
[PM2] Done.
┌────┬────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name               │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ default     │ 1.0.0   │ fork    │ 26865    │ 0s     │ 0    │ online    │ 0%       │ 27.9mb   │ root     │ disabled │
└────┴────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
┌────┬────────────────────┬─────────────┬─────────┬─────────┬──────────┬────────┬──────┬───────────┬──────────┬──────────┬──────────┬──────────┐
│ id │ name               │ namespace   │ version │ mode    │ pid      │ uptime │ ↺    │ status    │ cpu      │ mem      │ user     │ watching │
├────┼────────────────────┼─────────────┼─────────┼─────────┼──────────┼────────┼──────┼───────────┼──────────┼──────────┼──────────┼──────────┤
│ 0  │ albpetrol-legal    │ default     │ 1.0.0   │ fork    │ 26865    │ 10s    │ 0    │ online    │ 0%       │ 53.1mb   │ root     │ disabled │
└────┴────────────────────┴─────────────┴─────────┴─────────┴──────────┴────────┴──────┴───────────┴──────────┴──────────┴──────────┴──────────┘
[TAILING] Tailing last 5 lines for [all] processes (change the value with --lines option)
/root/.pm2/pm2.log last 5 lines:
PM2        | 2025-08-21T13:10:42: PM2 log: Stopping app:albpetrol-legal id:0
PM2        | 2025-08-21T13:10:42: PM2 log: App [albpetrol-legal:0] exited with code [0] via signal [SIGINT]
PM2        | 2025-08-21T13:10:42: PM2 log: pid=26803 msg=process killed
PM2        | 2025-08-21T13:10:42: PM2 log: App [albpetrol-legal:0] starting in -fork mode-
PM2        | 2025-08-21T13:10:42: PM2 log: App [albpetrol-legal:0] online

/root/.pm2/logs/albpetrol-legal-error.log last 5 lines:
0|albpetro |   pid: 26777,
0|albpetro |   stdout: null,
0|albpetro |   stderr: null
0|albpetro | }
0|albpetro | NODE_ENV=production is not supported in the .env file. Only NODE_ENV=development is supported to create a development build of your project. If you need to set process.env.NODE_ENV, you can set it in the Vite config instead.

/root/.pm2/logs/albpetrol-legal-out.log last 5 lines:
[✓] Pulling schema from database...
0|albpetro | 
0|albpetro | [i] No changes detected
0|albpetro | Database setup complete. Starting server...
0|albpetro | 1:10:44 PM [express] serving on port 5000

0|albpetrol-legal  | 1:11:11 PM [vite] Pre-transform error: Failed to load url /src/main.tsx?v=CT8oSeS9D1kmhJa6ZgZsy (resolved id: /src/main.tsx?v=CT8oSeS9D1kmhJa6ZgZsy). Does the file exist?
0|albpetrol-legal  | Setup failed: Error: Command failed: tsx server/index.ts
0|albpetrol-legal  |     at genericNodeError (node:internal/errors:984:15)
0|albpetrol-legal  |     at wrappedFn (node:internal/errors:538:14)
0|albpetrol-legal  |     at checkExecSyncError (node:child_process:891:11)
0|albpetrol-legal  |     at execSync (node:child_process:963:15)
0|albpetrol-legal  |     at Object.<anonymous> (/opt/ceshtje-ligjore/start_server.cjs:18:3)
0|albpetrol-legal  |     at Module._compile (node:internal/modules/cjs/loader:1529:14)
0|albpetrol-legal  |     at Module._extensions..js (node:internal/modules/cjs/loader:1613:10)
0|albpetrol-legal  |     at Module.load (node:internal/modules/cjs/loader:1275:32)
0|albpetrol-legal  |     at Module._load (node:internal/modules/cjs/loader:1096:12)
0|albpetrol-legal  |     at cjsLoader (node:internal/modules/esm/translators:298:15) {
0|albpetrol-legal  |   status: 1,
0|albpetrol-legal  |   signal: null,
0|albpetrol-legal  |   output: [ null, null, null ],
0|albpetrol-legal  |   pid: 26907,
0|albpetrol-legal  |   stdout: null,
0|albpetrol-legal  |   stderr: null
0|albpetrol-legal  | }
PM2                | App [albpetrol-legal:0] exited with code [1] via signal [SIGINT]
PM2                | App [albpetrol-legal:0] starting in -fork mode-
PM2                | App [albpetrol-legal:0] online
0|albpetrol-legal  | Setting up database...
0|albpetrol-legal  | Database exists, checking tables...
0|albpetrol-legal  | No config path provided, using default 'drizzle.config.ts'
0|albpetrol-legal  | Reading config file '/opt/ceshtje-ligjore/drizzle.config.ts'
0|albpetrol-legal  | [⣷] Pulling schema from database...
[✓] Pulling schema from database...
0|albpetrol-legal  | [i] No changes detected
0|albpetrol-legal  | Database setup complete. Starting server...
0|albpetrol-legal  | NODE_ENV=production is not supported in the .env file. Only NODE_ENV=development is supported to create a development build of your project. If you need to set process.env.NODE_ENV, you can set it in the Vite config instead.
0|albpetrol-legal  | 1:11:13 PM [express] serving on port 5000
^C
HTTP/1.1 200 OK
X-Powered-By: Express
Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self'; frame-ancestors 'none';
Strict-Transport-Security: max-age=31536000; includeSubDomains; preload
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
Vary: Origin
Content-Type: text/html; charset=utf-8
Date: Thu, 21 Aug 2025 13:11:24 GMT
Connection: keep-alive
Keep-Alive: timeout=5


🎉 Application should now be fully running at: http://10.5.20.31:5000
📊 Admin login: it.system@albpetrol.al / admin123
🗃️ Database: SQLite with all tables created successfully
📋 Features: Complete Albanian legal case management system
root@ceshtjeligjore:/opt/ceshtje-ligjore# 
